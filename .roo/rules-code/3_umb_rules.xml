<?xml version="1.0" encoding="UTF-8"?>
<umb_rules>
  <overview>
    Special command handling for "Update Memory Bank" (UMB) command that triggers 
    a comprehensive memory bank synchronization across all modes and activities.
  </overview>

  <trigger>
    <pattern>^(Update Memory Bank|UMB)$</pattern>
    <description>Command must exactly match "Update Memory Bank" or "UMB"</description>
  </trigger>

  <command_received_actions>
    <step number="1">
      <action>Halt Current Task</action>
      <description>Stop current activity immediately</description>
    </step>

    <step number="2">
      <action>Acknowledge Command</action>
      <response>[MEMORY BANK: UPDATING]</response>
    </step>

    <step number="3">
      <action>Review Chat History</action>
      <description>Analyze complete conversation history for context</description>
    </step>
  </command_received_actions>

  <core_update_process>
    <phase number="1">
      <name>Current Session Review</name>
      <description>Comprehensive analysis of the entire chat session</description>
      <tasks>
        <task>Analyze complete chat history</task>
        <task>Extract cross-mode information</task>
        <task>Track mode transitions</task>
        <task>Map activity relationships</task>
      </tasks>
    </phase>

    <phase number="2">
      <name>Comprehensive Updates</name>
      <description>Update Memory Bank from all perspectives</description>
      <tasks>
        <task>Update from all mode perspectives</task>
        <task>Preserve context across modes</task>
        <task>Maintain activity threads</task>
        <task>Document mode interactions</task>
      </tasks>
    </phase>

    <phase number="3">
      <name>Memory Bank Synchronization</name>
      <description>Ensure all Memory Bank files are current and consistent</description>
      <tasks>
        <task>Update all affected *.md files</task>
        <task>Ensure cross-mode consistency</task>
        <task>Preserve activity context</task>
        <task>Document continuation points</task>
      </tasks>
    </phase>
  </core_update_process>

  <task_focus>
    <description>
      During a UMB update, focus on capturing any clarifications, questions answered, 
      or context provided during the chat session.
    </description>
    
    <target_files>
      <file>activeContext.md - Most likely target</file>
      <file>decisionLog.md - For decisions made</file>
      <file>progress.md - For work completed</file>
      <file>systemPatterns.md - For new patterns</file>
      <file>productContext.md - For fundamental changes</file>
    </target_files>

    <guidelines>
      <guideline>Use other modes' update formats as a guide</guideline>
      <guideline>Do NOT summarize the entire project</guideline>
      <guideline>Do NOT perform actions outside the scope of the current chat</guideline>
      <guideline>Focus ONLY on information from this chat session</guideline>
    </guidelines>
  </task_focus>

  <cross_mode_updates>
    <description>
      Ensure all relevant information from the chat session is captured and added 
      to the Memory Bank, including cross-mode activities.
    </description>

    <what_to_capture>
      <item>Clarifications provided during the chat</item>
      <item>Questions answered</item>
      <item>Context provided</item>
      <item>Mode transitions and reasons</item>
      <item>Decisions made across modes</item>
      <item>Work completed in different modes</item>
    </what_to_capture>

    <reference>
      Use the other modes' update formats as a guide for adding this information 
      to the appropriate Memory Bank files.
    </reference>
  </cross_mode_updates>

  <post_umb_actions>
    <description>Actions to take after UMB update is complete</description>
    
    <confirmations>
      <confirmation>Memory Bank fully synchronized</confirmation>
      <confirmation>All mode contexts preserved</confirmation>
      <confirmation>Session can be safely closed</confirmation>
      <confirmation>Next assistant will have complete context</confirmation>
    </confirmations>

    <user_notification>
      Inform the user that the Memory Bank has been successfully updated 
      with all relevant information from this session.
    </user_notification>
  </post_umb_actions>

  <override_settings>
    <setting name="override_file_restrictions">
      <value>true</value>
      <description>UMB command bypasses normal file editing restrictions</description>
    </setting>

    <setting name="override_mode_restrictions">
      <value>true</value>
      <description>UMB command can access all Memory Bank files regardless of mode</description>
    </setting>
  </override_settings>

  <important_notes>
    <note priority="critical">
      UMB is a privileged command that temporarily grants elevated permissions 
      to update all Memory Bank files.
    </note>

    <note priority="high">
      Focus on session-specific information. Do not attempt to reconstruct 
      or summarize the entire project.
    </note>

    <note priority="high">
      Always include timestamps in all Memory Bank updates following the format: 
      [YYYY-MM-DD HH:MM:SS] - [Summary]
    </note>
  </important_notes>
</umb_rules>